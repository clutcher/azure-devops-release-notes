# Azure DevOps Release Notes Generator

A Python script to automatically generate release notes from Azure DevOps work items. Queries work items and releases for a specific release number and generates a markdown document formatted for Azure DevOps wiki.

> **Note:** This project was generated by Claude Code with minimal code review of results.

## What It Does

### Features

- **Zero External Dependencies** - Uses only Python standard library
- **Comprehensive Release Notes** - Includes work items, deployed services, deployment instructions, and contributors
- **Professional Formatting** - JReleaser-style markdown with emojis and statistics
- **Flexible Configuration** - All settings via command-line arguments
- **CI/CD Ready** - Environment variable support for secrets
- **Type-Safe** - Full type hints throughout codebase
- **Flexible Sorting** - Sort work items by ID (default) or alphabetically by title
- **Parent Grouping** - Group work items by parent ticket for better organization

### Output Format

The tool generates a comprehensive markdown document with:

#### üìä Summary Section
- Release date (extracted from production deployments, shows "Unreleased" if no deployments)
- Sprint/iteration information
- Total work items count
- Microservices released count
- Breakdown by work item type (Bug, Feature, etc.)

#### üì¶ Binaries Section
- Microservice names (linked to Azure DevOps pipelines)
- Version numbers (linked to release details)
- Sorted alphabetically

#### üìù Changelog Section
- Work items grouped by type
- Sortable by ID (default) or title alphabetically
- Optional sub-grouping by parent ticket within each type
- Linked to Azure DevOps work items
- Includes emojis for visual categorization

#### üöÄ Deployment Instructions Section
- Work items with deployment notes
- Extracted from work item notes field
- Structured as nested lists with links to work items

#### üë• Contributors Section
- Alphabetically sorted contributors
- Extracted from work item revision history
- System accounts automatically filtered

### Example Output

The following example shows output with `--group-by-parent` enabled (work items grouped by parent ticket within each type):

```markdown
# Release Notes - 2025.006

## üìä Summary

**Release Date:** November 06, 2025

**Iteration:** Sprint 24, Sprint 23

**Total Work Items:** 15
**Microservices Released:** 3

**Breakdown by Type:**

- üêõ **Bug:** 5
- ‚ú® **Feature:** 8
- üîß **Task:** 2

## üì¶ Binaries

| Microservice | Version |
|--------------|---------|
| [auth-service](https://dev.azure.com/org/project/_release?...) | [v1.2.3](https://dev.azure.com/org/project/_releaseProgress?...) |
| [api-gateway](https://dev.azure.com/org/project/_release?...) | [v2.0.1](https://dev.azure.com/org/project/_releaseProgress?...) |

## üìù Changelog

### üêõ Bug (5)

#### [#100](https://dev.azure.com/org/project/_workitems/edit/100) Authentication Epic

- [#1234](https://dev.azure.com/org/project/_workitems/edit/1234) Fix login authentication issue
- [#1235](https://dev.azure.com/org/project/_workitems/edit/1235) Resolve database connection timeout

#### üìå Standalone Items

- [#1236](https://dev.azure.com/org/project/_workitems/edit/1236) Fix minor UI glitch

### ‚ú® Feature (8)

#### [#200](https://dev.azure.com/org/project/_workitems/edit/200) UI Improvements Epic

- [#1240](https://dev.azure.com/org/project/_workitems/edit/1240) Add dark mode support
- [#1241](https://dev.azure.com/org/project/_workitems/edit/1241) Implement advanced search

## üöÄ Deployment Instructions

- [#1234](https://dev.azure.com/org/project/_workitems/edit/1234)
  - Run database migration scripts before deployment
  - Clear Redis cache after deployment
  - Restart authentication service

## üë• Contributors

- Alice Developer
- Bob Engineer
- Charlie Tester
```

## How to Use It

### Requirements

- **Python 3.7+** (uses dataclasses and type hints)
- **Azure DevOps PAT token** with Work Items (Read) and Build/Release (Read) permissions

### Installation

```bash
# Clone the repository
git clone https://github.com/clutcher/azure-devops-release-notes.git
cd azure-devops-release-notes

# Install development dependencies (for testing)
pip install -r requirements-dev.txt
```

### Quick Start

#### 1. Create a Personal Access Token (PAT)

1. Navigate to Azure DevOps ‚Üí User Settings ‚Üí Personal Access Tokens
2. Click "New Token"
3. Grant **Read** permissions for:
   - Work Items
   - Build
   - Release
4. Copy the token value

#### 2. Generate Release Notes

```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --pat YOUR_PAT_TOKEN
```

Or using environment variable (recommended):

```bash
export AZURE_DEVOPS_PAT=your_pat_token

python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject
```

### Usage

#### Command Line Interface

```
usage: generate_release_notes.py [-h] --organization ORGANIZATION
                                 --project PROJECT [--pat PAT]
                                 [--release-field RELEASE_FIELD]
                                 [--notes-field NOTES_FIELD]
                                 [--prod-env PROD_ENV] [-o OUTPUT]
                                 [--sort-by {id,title}]
                                 [--group-by-parent]
                                 release

positional arguments:
  release               Release number (e.g., 2025.006)

required arguments:
  --organization ORG    Azure DevOps organization URL
  --project PROJECT     Azure DevOps project name

optional arguments:
  --pat PAT             Personal Access Token (or use AZURE_DEVOPS_PAT env var)
  --release-field FIELD Custom field for release tracking (default: Custom.Release)
  --notes-field FIELD   Work item field for deployment notes (default: System.Description)
  --prod-env ENV        Production environment name (default: PROD)
  -o, --output FILE     Output file path (default: Release-Notes-<release>.md)
  --sort-by {id,title}  Sort work items by id or title (default: id)
  --group-by-parent     Group work items by parent ticket within each type
```

#### Examples

**Basic usage with PAT argument:**
```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --pat abc123xyz
```

**Using environment variable (CI/CD):**
```bash
AZURE_DEVOPS_PAT=abc123xyz python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject
```

**Custom release field, notes field, and output file:**
```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --release-field Custom.ReleaseVersion \
  --notes-field Custom.DeploymentNotes \
  --prod-env Production \
  -o docs/release-2025-006.md
```

**Sort work items alphabetically by title:**
```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --sort-by title
```

**Group work items by parent ticket:**
```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --group-by-parent
```

**Combine sorting and grouping:**
```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --sort-by title \
  --group-by-parent
```

## Common Issues

### Troubleshooting

#### Authentication Errors

**Error:** `Error: PAT token required`
- **Solution:** Provide PAT via `--pat` argument or `AZURE_DEVOPS_PAT` environment variable

**Error:** `Error querying work items: 401 Unauthorized`
- **Solution:** Verify PAT token is valid and not expired
- Ensure PAT has Work Items (Read) permission

#### No Work Items Found

**Issue:** `No work items found for release 'X.XXX'`
- Verify release number matches exactly (case-sensitive)
- Check that `--release-field` matches your Azure DevOps custom field name
- Confirm work items are tagged with the release number

#### API Connection Errors

**Error:** `Error connecting to Azure DevOps`
- Verify organization URL is correct (e.g., `https://dev.azure.com/myorg`)
- Check network connectivity
- Ensure project name is correct and you have access

#### Missing Microservices

**Issue:** Binaries section is empty
- Verify releases are tagged with the release number
- Check that PAT has Build/Release (Read) permissions
- Confirm `--prod-env` matches your environment name

#### Missing Deployment Instructions

**Issue:** Deployment Instructions section is empty
- Verify work items have notes in the configured notes field
- Check that `--notes-field` matches your Azure DevOps field (default: System.Description)
- Ensure the notes field contains HTML list items (`<li>...</li>`)

## Advanced Usage

#### Release Field Customization

If your Azure DevOps uses a different custom field for release tracking:

```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --release-field Custom.YourFieldName
```

#### Notes Field Customization

If your deployment notes are stored in a different field:

```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --notes-field Custom.DeploymentInstructions
```

#### Production Environment Name

If your production environment has a different name:

```bash
python generate_release_notes.py 2025.006 \
  --organization https://dev.azure.com/myorg \
  --project MyProject \
  --prod-env Production
```

### CI/CD Integration

#### GitHub Actions Example

```yaml
name: Generate Release Notes

on:
  workflow_dispatch:
    inputs:
      release:
        description: 'Release number (e.g., 2025.006)'
        required: true

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: release
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Extract Year from Release
        id: extract_year
        run: |
          RELEASE="${{ github.event.inputs.release }}"
          YEAR=$(echo $RELEASE | cut -d. -f1)
          echo "year=$YEAR" >> $GITHUB_OUTPUT
          echo "release=$RELEASE" >> $GITHUB_OUTPUT

      - name: Generate Release Notes
        env:
          AZURE_DEVOPS_PAT: ${{ secrets.AZURE_DEVOPS_PAT }}
        run: |
          # Create output directory
          OUTPUT_DIR="docs/Releases/${{ steps.extract_year.outputs.year }}"
          mkdir -p "$OUTPUT_DIR"

          # Generate release notes
          python generate_release_notes.py ${{ github.event.inputs.release }} \
            --organization https://dev.azure.com/myorg \
            --project MyProject \
            -o "$OUTPUT_DIR/Release-${{ github.event.inputs.release }}.md"

      - name: Commit and Push Release Notes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"

          git add docs/Releases/${{ steps.extract_year.outputs.year }}/Release-${{ github.event.inputs.release }}.md
          git commit -m "chore: Add release notes for ${{ github.event.inputs.release }}"
          git push origin release

      - name: Upload Release Notes Artifact
        uses: actions/upload-artifact@v3
        with:
          name: release-notes-${{ github.event.inputs.release }}
          path: docs/Releases/${{ steps.extract_year.outputs.year }}/Release-${{ github.event.inputs.release }}.md
```

#### Azure Pipelines Example

```yaml
trigger: none
pr: none

resources:
  repositories:
    - repository: release-notes-generator
      type: github
      name: your-org/azure-devops-release-notes  # Your fork of the generator
      ref: refs/heads/main
      endpoint: github-service-connection  # Your GitHub service connection

parameters:
  - name: releaseNumber
    displayName: 'Release Number (e.g., 2025.006)'
    type: string

variables:
  - group: release-notes-secrets  # Variable group containing RELEASE_NOTES_PAT
  - name: releaseYear
    value: ${{ split(parameters.releaseNumber, '.')[0] }}
  - name: outputDir
    value: 'docs/Releases/$(releaseYear)'
  - name: outputFile
    value: 'Release-${{ parameters.releaseNumber }}.md'
  - name: RELEASE_FIELD
    value: 'Custom.Release'
  - name: PROD_ENV
    value: 'PROD'
  - name: NOTES_FIELD
    value: 'Custom.Notes'

stages:
- stage: GenerateReleaseNotes
  jobs:
  - job: GenerateAndCreatePR
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - checkout: self
      persistCredentials: true
    - checkout: release-notes-generator

    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.9'

    # Validate release number format
    - script: |
        if ! echo "${{ parameters.releaseNumber }}" | grep -qE '^[0-9]{4}\.[0-9]{3}$'; then
          echo "##vso[task.logissue type=error]Invalid release number format. Expected: YYYY.NNN (e.g., 2025.006)"
          exit 1
        fi
      displayName: 'Validate Release Number Format'

    - script: |
        set -e

        cd $(Build.SourcesDirectory)/your-repo  # Your target repository name

        # Configure git
        git config user.email "noreply@dev.azure.com"
        git config user.name "Azure Pipelines"

        # Check if remote branch exists
        BRANCH_NAME="release-notes/${{ parameters.releaseNumber }}"

        if git ls-remote --exit-code --heads origin "$BRANCH_NAME"; then
            echo "Branch $BRANCH_NAME exists. Checking out and pulling..."
            git fetch origin "$BRANCH_NAME"
            git checkout "$BRANCH_NAME"
            git pull origin "$BRANCH_NAME"
        else
            echo "Creating a new branch $BRANCH_NAME from main..."
            git fetch origin main
            git checkout main
            git checkout -b "$BRANCH_NAME"
        fi

        mkdir -p "$(Build.SourcesDirectory)/your-repo/$(outputDir)"
        cd $(Build.SourcesDirectory)/release-notes-generator

        pip install -r requirements.txt

        # Generate release notes
        echo "Generating release notes for release ${{ parameters.releaseNumber }}"

        python generate_release_notes.py ${{ parameters.releaseNumber }} \
          --organization $(System.TeamFoundationCollectionUri) \
          --project $(System.TeamProject) \
          --release-field "$(RELEASE_FIELD)" \
          --prod-env "$(PROD_ENV)" \
          --notes-field "$(NOTES_FIELD)" \
          --group-by-parent \
          --pat $(RELEASE_NOTES_PAT) \
          -o "$(Build.SourcesDirectory)/your-repo/$(outputDir)/$(outputFile)"

        # Verify file was created
        if [ ! -f "$(Build.SourcesDirectory)/your-repo/$(outputDir)/$(outputFile)" ]; then
          echo "##vso[task.logissue type=error]Release notes file was not generated"
          exit 1
        fi

        echo "Release notes generated successfully"
        ls -lh "$(Build.SourcesDirectory)/your-repo/$(outputDir)/$(outputFile)"

        cd $(Build.SourcesDirectory)/your-repo

        git add "$(outputDir)/$(outputFile)"

        # Check if there are changes
        if git diff --quiet && git diff --cached --quiet; then
          echo "##vso[task.logissue type=warning]No changes detected. Release notes may already exist."
          exit 0
        fi

        git commit -m "Add release notes for ${{ parameters.releaseNumber }}"
        git push origin "$BRANCH_NAME"

        # Check if PR already exists
        PR_RESPONSE=$(curl -s -X GET \
          -u ":$(System.AccessToken)" \
          "$(System.CollectionUri)$(System.TeamProject)/_apis/git/repositories/your-repo/pullrequests?searchCriteria.sourceRefName=refs/heads/$BRANCH_NAME&searchCriteria.targetRefName=refs/heads/release&api-version=6.0")

        PR_COUNT=$(echo "$PR_RESPONSE" | jq '.count')

        if [ "$PR_COUNT" -gt 0 ]; then
          echo "PR already exists. Updated the branch with new commits."
        else
          # Create PR
          echo "Creating Pull Request..."

          PR_PAYLOAD=$(jq -n \
            --arg source "refs/heads/$BRANCH_NAME" \
            --arg target "refs/heads/release" \
            --arg title "Release Notes ${{ parameters.releaseNumber }}" \
            --arg desc "Auto-generated release notes for release ${{ parameters.releaseNumber }}" \
            '{sourceRefName: $source, targetRefName: $target, title: $title, description: $desc}')

          response=$(curl -s -X POST \
            -u ":$(System.AccessToken)" \
            -H "Content-Type: application/json" \
            -d "$PR_PAYLOAD" \
            "$(System.CollectionUri)$(System.TeamProject)/_apis/git/repositories/your-repo/pullrequests?api-version=6.0")

          if ! echo "$response" | grep -q "pullRequestId"; then
            echo "##vso[task.logissue type=error]Failed to create PR"
            exit 1
          fi

          echo "PR created successfully"
        fi
      displayName: 'Generate Release Notes and Create PR'

    - task: PublishBuildArtifacts@1
      inputs:
        pathToPublish: '$(Build.SourcesDirectory)/your-repo/$(outputDir)/$(outputFile)'
        artifactName: 'release-notes-${{ parameters.releaseNumber }}'
      displayName: 'Publish Release Notes Artifact'
```

**Setup Requirements:**
1. Create a GitHub service connection named `github-service-connection`
2. Create a variable group `release-notes-secrets` with `RELEASE_NOTES_PAT` (PAT with Work Items Read permission)
3. Replace `your-org/azure-devops-release-notes` with your GitHub repository
4. Replace `your-repo` with your target Azure DevOps repository name
5. Grant the build service permission to create branches and PRs

## For Developers

### Development Setup

#### Running Tests

```bash
# Install development dependencies
pip install -r requirements-dev.txt

# Run all tests
pytest

# Run with coverage
pytest --cov=src --cov-report=html

# Run specific test file
pytest tests/test_models.py
```

### Project Structure

```
.
‚îú‚îÄ‚îÄ generate_release_notes.py  # Main CLI script
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # Configuration management
‚îÇ   ‚îú‚îÄ‚îÄ models.py              # Data models (WorkItem, Release)
‚îÇ   ‚îú‚îÄ‚îÄ azure_devops_client.py # Azure DevOps API client
‚îÇ   ‚îî‚îÄ‚îÄ markdown_generator.py  # Markdown formatting
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py            # Pytest fixtures
‚îÇ   ‚îú‚îÄ‚îÄ test_config.py
‚îÇ   ‚îú‚îÄ‚îÄ test_models.py
‚îÇ   ‚îú‚îÄ‚îÄ test_azure_devops_client.py
‚îÇ   ‚îî‚îÄ‚îÄ test_markdown_generator.py
‚îú‚îÄ‚îÄ requirements.txt           # Runtime dependencies (none)
‚îú‚îÄ‚îÄ requirements-dev.txt       # Development dependencies
‚îî‚îÄ‚îÄ README.md
```

### Security Best Practices

- ‚úÖ **Never commit PAT tokens** to version control
- ‚úÖ **Use environment variables** for PAT tokens in CI/CD
- ‚úÖ **Rotate PAT tokens regularly** (every 90 days)
- ‚úÖ **Grant minimum permissions** (Work Items: Read, Build: Read, Release: Read)
- ‚úÖ **Use short-lived tokens** for automated pipelines
- ‚úÖ **Store PAT in secrets management** (GitHub Secrets, Azure Key Vault)
